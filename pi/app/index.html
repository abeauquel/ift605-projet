<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Piapp</title>
</head>
<body>
<script src="js/three.js"></script>
<script>
    const scene = new THREE.Scene();
    const camera = new THREE.PerspectiveCamera( 75, window.innerWidth / window.innerHeight, 0.1, 1000 );

    const renderer = new THREE.WebGLRenderer();
    renderer.setSize( window.innerWidth, window.innerHeight );
    document.body.appendChild( renderer.domElement );

    const geometry = new THREE.BoxGeometry();
    const material = new THREE.MeshBasicMaterial( { color: 0x00ff00 } );
    const cube = new THREE.Mesh( geometry, material );
    scene.add( cube );

    camera.position.z = 5;

    const animate = function (x, y, z) {
        //requestAnimationFrame( animate );c
        cube.rotation.x += x;
        cube.rotation.y += y;
        //cube.rotation.z += z;
        // cube.translateX(x);
        // cube.translateY(y);
        renderer.render( scene, camera );
    };

    //webSocket
    //Cr√©er une connexion WebSocket
    const socket = new WebSocket('ws://localhost:9898');

    socket.onopen = function(e) {
       console.log("[open] Connection established");
       console.log("Sending to server");
        //socket.send("My name is John");
    };

    socket.onmessage = function(event) {
        let data = JSON.parse(event.data);
        animate(data.x, data.y, data.z);
        //console.log(`[message] Data received from server: ${event.data}`);
    };

    socket.onclose = function(event) {
        if (event.wasClean) {
            console.log(`[close] Connection closed cleanly, code=${event.code} reason=${event.reason}`);
        } else {
            // e.g. server process killed or network down
            // event.code is usually 1006 in this case
            console.log('[close] Connection died');
        }
    };

    socket.onerror = function(error) {
        console.log(`[error] ${error.message}`);
    };

</script>
</body>
</html>